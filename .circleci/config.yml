version: 2
jobs:
   build:
     docker:
       - image: circleci/node:latest
     working_directory: ~/react-cafe-cms
     steps:
       - checkout
       - run:
           name: Install pcakage
           command: yarn install
       - save_cache:
           key: dependency-cache-1
           paths:
             - ~/react-cafe-cms/node_modules

   test:
      docker:
        - image: circleci/node:latest
      working_directory: ~/react-cafe-cms
      steps:
        - checkout
        - restore_cache:
            keys:
            # Find a cache corresponding to this specific package.json checksum
            # when this file is changed, this key will fail
              - dependency-cache-1
        - run:
            name: Test
            command: yarn test
        - run:
            name: Save test results
            command: |
               mkdir -p ~/test-report
               bundle exec test-report --format junit --out ~/cucumber/junit.xml
            when: always
        - store_test_results:
            path: ~/test-report
        - store_artifacts:
            path: ~/test-report

workflows:
  version: 2
  build_and_test:
    jobs:
      - build
      - test:
          requires:
            - build
